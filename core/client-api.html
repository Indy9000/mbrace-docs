<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>MBrace Client API
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An open source framework for large-scale distributed computation and data processing written in F#."/>
    <meta name="author" content="Jan Dzik, Nick Palladinos, Kostas Rontogiannis, Eirik Tsarpalis"/>
    
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-196x196.png" sizes="196x196"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-160x160.png" sizes="160x160"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-96x96.png" sizes="96x96"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-16x16.png" sizes="16x16"/>
    <link rel="icon" type="image/png" href="http://www.m-brace.net/img/favicon-32x32.png" sizes="32x32"/>

    <link type="text/css" rel="stylesheet" href="http://www.m-brace.net/content/style.css" />
    <script type="text/javascript" src="http://www.m-brace.net/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://nessos.github.io">nessos</a></li>
          <li><a href="http://github.com/mbraceproject/MBrace.Core">github page</a></li>
        </ul>
        <h3 class="muted"><a href="http://www.m-brace.net/index.html">MBrace</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="MBrace-Client-API" class="anchor" href="#MBrace-Client-API">MBrace Client API</a></h1>

<p>The following article provides an overview of the MBrace client API,
the collection of types and methods used for interacting with the MBrace runtime.
These include</p>

<ol>
<li><p>The cloud workflow <a href="progamming-model.html">programming model</a>.</p></li>
<li><p>An interface for managing and interacting with the MBrace runtime, that can 
be roughly divided in the following categories:</p>
<ul>
<li><p>Runtime administration functionality, that includes cluster management operations, 
health monitoring and real-time elastic node management.</p></li>
<li><p>Cloud process management functionality, that includes submission of computations, 
process monitoring, debugging and storage access.</p></li>
</ul></li>
<li><p>The MBrace shell, which enables interactive, on-the-fly declaration, 
deployment and debugging of cloud computation through the F# REPL.</p></li>
<li><p>A collection of command line tools for server-side deployments.</p></li>
<li><p>A library of combinators implementing common parallelism workflows like MapReduce 
or nondeterministic algorithms and a multitude of sample implementations.</p></li>
</ol>

<h2><a name="Installation" class="anchor" href="#Installation">Installation</a></h2>

<p>These can be accessed by adding the <a href="http://www.nuget.org/packages/MBrace.Client"><code>MBrace.Client</code></a> 
nuget package to projects. Alternatively, they can be consumed from F# interactive 
by installing <a href="http://www.nuget.org/packages/MBrace.Runtime"><code>MBrace.Runtime</code></a> and loading</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="prep">#load</span> <span class="s">&quot;../packages/MBrace.Runtime/bootstrap.fsx&quot;</span>

<span class="k">open</span> <span class="i">Nessos</span><span class="o">.</span><span class="i">MBrace</span>
<span class="k">open</span> <span class="i">Nessos</span><span class="o">.</span><span class="i">MBrace</span><span class="o">.</span><span class="i">Client</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">runtime</span> <span class="o">=</span> <span class="i">MBrace</span><span class="o">.</span><span class="i">InitLocal</span>(<span class="i">totalNodes</span> <span class="o">=</span> <span class="n">3</span>)

<span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">runtime</span><span class="o">.</span><span class="i">Run</span> &lt;@ <span class="i">cloud</span> { <span class="k">return</span> <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> } @&gt;
</pre>
</td>
</tr>
</table>

<p>MBrace is compatible with Visual Studio 2012 and 2013.
If using F# 3.0/Visual Studio 2012, a binding redirect for <code>FSharp.Core</code>
needs to be set up</p>

<table class="pre"><tr><td><pre lang="xml"><span class="k">&lt;</span><span class="i">configuration</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">runtime</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">assemblyBinding</span> <span class="o">xmlns</span><span class="k">="urn:schemas-microsoft-com:asm.v1"</span><span class="k">&gt;</span>
      <span class="k">&lt;</span><span class="i">dependentAssembly</span><span class="k">&gt;</span>
        <span class="k">&lt;</span><span class="i">assemblyIdentity</span> <span class="o">name</span><span class="k">="FSharp.Core"</span> <span class="o">publicKeyToken</span><span class="k">="b03f5f7f11d50a3a"</span> <span class="o">culture</span><span class="k">="neutral"</span> <span class="k">/&gt;</span>
        <span class="k">&lt;</span><span class="i">bindingRedirect</span> <span class="o">oldVersion</span><span class="k">="0.0.0.0-4.3.1.0"</span> <span class="o">newVersion</span><span class="k">="4.3.0.0"</span> <span class="k">/&gt;</span>
      <span class="k">&lt;/</span><span class="i">dependentAssembly</span><span class="k">&gt;</span>
    <span class="k">&lt;/</span><span class="i">assemblyBinding</span><span class="k">&gt;</span>
  <span class="k">&lt;/</span><span class="i">runtime</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">configuration</span><span class="k">&gt;</span>
</pre></td></tr></table>

<h2><a name="The-Cloud-Attribute" class="anchor" href="#The-Cloud-Attribute">The Cloud Attribute</a></h2>

<p>A primary function of the MBrace client is statically traversing cloud workflows for library dependencies, 
extracting metadata to be used for debugging purposes, 
as well as detecting and emitting warnings for potentially invalid patterns. 
This static traversal is in part achieved through the help of F# code quotations. 
Quotations are an excellent resource for metadata and as such, they are utilized by MBrace.</p>

<p>Cloud computations in MBrace are initialized like so:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 46)" onmouseover="showTip(event, 'fs5', 46)" class="i">proc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 47)" onmouseover="showTip(event, 'fs4', 47)" class="i">runtime</span><span class="o">.</span><span class="i">CreateProcess</span> &lt;@ <span class="i">cloud</span> { <span class="k">return</span> <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> } @&gt;
</pre>
</td>
</tr>
</table>

<p>where runtime denotes a client object to a running MBrace cluster. 
A peculiar feature of this syntax is that cloud blocks are delimited by <code>&lt;@</code> and <code>@&gt;</code> symbols. 
These are part of the F# language feature known as <a href="http://msdn.microsoft.com/en-us/library/dd233212.aspx">code quotations</a>. 
Any F# expression enclosed in these symbols will yield a typed syntax tree 
of the given expression, also known as its quotation. Evaluating</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">expr</span> <span class="o">=</span> &lt;@ <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> @&gt;
</pre>
</td>
</tr>
</table>

<p>gives a syntax tree which, if evaluated, will yield a result of type <code>int</code>.</p>

<p>Even though workflows need to be quoted for execution, it does not mean 
that all referenced workfows have to be expression trees;
only the top-level expression need be so.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
[&lt;<span class="i">Cloud</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="f">test</span> () <span class="o">=</span> <span class="i">cloud</span> { <span class="k">return</span> <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> }

<span onmouseout="hideTip(event, 'fs4', 10)" onmouseover="showTip(event, 'fs4', 10)" class="i">runtime</span><span class="o">.</span><span class="i">Run</span> &lt;@ <span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">test</span> () @&gt;
</pre>
</td>
</tr>
</table>

<p>Despite this, all nested calls to cloud workflows should be affixed with a <code>[&lt;Cloud&gt;]</code> attribute. 
Failing to do so will result in warning messages being raised. 
The Cloud attribute is just an abbreviation of the 
<a href="http://msdn.microsoft.com/en-us/library/ee353643.aspx"><code>ReflectedDefinitionAttribute</code></a> 
provided by F#. Adding this to a declaration makes the F# compiler generate a reflected quotation to the tagged code.</p>

<p>It should be noted that the Cloud attribute is not needed for F# declarations that are not cloud workflows. 
For example, the following code is perfectly valid:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="f">f</span> <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 14)" onmouseover="showTip(event, 'fs9', 14)" class="i">x</span> <span class="o">+</span> <span class="n">1</span>

<span onmouseout="hideTip(event, 'fs4', 15)" onmouseover="showTip(event, 'fs4', 15)" class="i">runtime</span><span class="o">.</span><span class="i">Run</span> &lt;@ <span class="i">cloud</span> { <span class="k">return</span> <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="i">f</span> <span class="n">41</span> } @&gt;
</pre>
</td>
</tr>
</table>

<h2><a name="Store-Providers" class="anchor" href="#Store-Providers">Store Providers</a></h2>

<p>Every MBrace runtime requires a storage backend in order for it to function. 
This enables distributed storage primitives like cloud refs and cloud files 
and is used by internally the runtime for logging purposes. 
The MBrace runtime does not provide its own distributed storage implementation, 
rather it relies on pluggable storage providers which can be user defined.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span class="i">Nessos</span><span class="o">.</span><span class="i">MBrace</span><span class="o">.</span><span class="i">Store</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 17)" onmouseover="showTip(event, 'fs10', 17)" class="i">fsStore</span> <span class="o">=</span> <span class="i">FileSystemStore</span><span class="o">.</span><span class="i">Create</span>(<span class="s">@&quot;\\FileServer\path\to\mbrace&quot;</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="i">sqlStore</span> <span class="o">=</span> <span class="i">SqlServerStore</span><span class="o">.</span><span class="i">Create</span>(<span class="i">connectionString</span> <span class="o">=</span> <span class="s">&quot;connectionString&quot;</span>)

<span class="k">open</span> <span class="i">Nessos</span><span class="o">.</span><span class="i">MBrace</span><span class="o">.</span><span class="i">Azure</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="i">azureStore</span> <span class="o">=</span> <span class="i">AzureStore</span><span class="o">.</span><span class="i">Create</span>(<span class="i">accountName</span> <span class="o">=</span> <span class="s">&quot;name&quot;</span>, <span class="i">accountKey</span> <span class="o">=</span> <span class="s">&quot;key&quot;</span>)
</pre>
</td>
</tr>
</table>

<p>The default store implementation of a client session can be specified by setting</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">MBraceSettings</span><span class="o">.</span><span class="i">DefaultStore</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="i">azureStore</span>
</pre>
</td>
</tr>
</table>

<p>User-defined storage providers can be created by implementing the 
<a href="reference/nessos-mbrace-store-icloudstore.html"><code>ICloudStore</code></a> interface.</p>

<h2><a name="Managing-the-MBrace-Runtime" class="anchor" href="#Managing-the-MBrace-Runtime">Managing the MBrace Runtime</a></h2>

<p>The MBrace runtime is a cluster of connected computers capable of 
orchestrating the execution of cloud workflows. 
Every computer participating in an MBrace runtime is called an MBrace node. 
In this section we offer an overview of how the MBrace client stack can be used to initialize, 
manage and monitor remote MBrace runtimes.</p>

<h3><a name="MBraceNode" class="anchor" href="#MBraceNode">MBraceNode</a></h3>

<p>An <a href="reference/nessos-mbrace-client-mbracenode.html"><code>MBraceNode</code></a> represents any 
physical machine that runs the MBrace daemon, the server-side component of the framework. 
Every MBrace daemon accepts connections from a predetermined tcp port on the host. 
MBrace nodes are identifiable by the uri format</p>

<table class="pre"><tr><td><pre lang="ascii">mbrace://hostname:port/
</pre></td></tr></table>

<p>The MBrace client can connect to a remote node by calling</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="i">node</span>  <span class="o">=</span> <span class="i">Node</span><span class="o">.</span><span class="i">Connect</span>(<span class="s">&quot;mbrace://hostname:2675&quot;</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 22)" onmouseover="showTip(event, 'fs14', 22)" class="i">node&#39;</span> <span class="o">=</span> <span class="i">Node</span><span class="o">.</span><span class="i">Connect</span>(<span class="s">&quot;hostname&quot;</span>, <span class="n">2675</span>) <span class="c">// equivalent to the above</span>
</pre>
</td>
</tr>
</table>

<p>A node in the local machine can be initialized by calling</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="i">node&#39;&#39;</span> <span class="o">=</span> <span class="i">Node</span><span class="o">.</span><span class="i">Spawn</span>(<span class="i">hostname</span> <span class="o">=</span> <span class="s">&quot;10.0.0.12&quot;</span>, <span class="i">primaryPort</span> <span class="o">=</span> <span class="n">2675</span>)
</pre>
</td>
</tr>
</table>

<p>This will initialize an object of type MBraceNode. 
This object acts as a handle to the remote node. 
It can be used to perform a variety of operations like</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="i">node</span><span class="o">.</span><span class="i">Ping</span>() <span class="c">// ping the node, returning the number of milliseconds taken</span>
</pre>
</td>
</tr>
</table>

<p>or</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs13', 25)" onmouseover="showTip(event, 'fs13', 25)" class="i">node</span><span class="o">.</span><span class="i">IsLocal</span>
</pre>
</td>
</tr>
</table>

<p>which is a property indicating whether the node is part of an existing MBrace cluster.</p>

<p>Every MBrace daemon writes to a log of its own. 
MBrace node logs can accessed remotely from the client either in the form of a dump</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="i">node</span><span class="o">.</span><span class="i">ShowSystemLogs</span>()
</pre>
</td>
</tr>
</table>

<p>or in a structured format that can be used to perform local queries:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs13', 27)" onmouseover="showTip(event, 'fs13', 27)" class="i">node</span><span class="o">.</span><span class="i">GetSystemLogs</span>()
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 28)" onmouseover="showTip(event, 'fs16', 28)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs18', 30)" onmouseover="showTip(event, 'fs18', 30)" class="i">entry</span> <span class="k">-&gt;</span> <span class="i">DateTime</span><span class="o">.</span><span class="i">Now</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs18', 31)" onmouseover="showTip(event, 'fs18', 31)" class="i">entry</span><span class="o">.</span><span class="i">Date</span> <span class="o">&lt;</span> <span class="i">TimeSpan</span><span class="o">.</span><span class="i">FromDays</span> <span class="n">1.</span>)
</pre>
</td>
</tr>
</table>

<h3><a name="MBraceRuntime" class="anchor" href="#MBraceRuntime">MBraceRuntime</a></h3>

<p>An MBrace runtime can be booted once access to a collection of at least 3 nodes, 
all running within the same subnet, has been established. This can be done like so:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 32)" onmouseover="showTip(event, 'fs19', 32)" class="i">nodes</span> <span class="o">=</span> [ <span onmouseout="hideTip(event, 'fs13', 33)" onmouseover="showTip(event, 'fs13', 33)" class="i">node</span> ; <span onmouseout="hideTip(event, 'fs14', 34)" onmouseover="showTip(event, 'fs14', 34)" class="i">node&#39;</span> ; <span onmouseout="hideTip(event, 'fs15', 35)" onmouseover="showTip(event, 'fs15', 35)" class="i">node&#39;&#39;</span> ]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 36)" onmouseover="showTip(event, 'fs4', 36)" class="i">runtime</span> <span class="o">=</span> <span class="i">MBraceRuntime</span><span class="o">.</span><span class="i">Boot</span>(<span onmouseout="hideTip(event, 'fs19', 37)" onmouseover="showTip(event, 'fs19', 37)" class="i">nodes</span>, <span class="i">store</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 38)" onmouseover="showTip(event, 'fs12', 38)" class="i">azureStore</span>)
</pre>
</td>
</tr>
</table>

<p>This will initialize an MBrace cluster that connects to a Windows Azure store endpoint. 
Once boot is completed, a handle of type <a href="reference/nessos-mbrace-client-mbracenode.html"><code>MBraceRuntime</code></a> 
will be returned. If no store is specified explicitly, the MBraceSettings.DefaultStore will be used. 
To connect to an already booted MBrace runtime, one needs simply write</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 39)" onmouseover="showTip(event, 'fs4', 39)" class="i">runtime</span> <span class="o">=</span> <span class="i">MBraceRuntime</span><span class="o">.</span><span class="i">Connect</span>(<span class="s">&quot;mbrace://host:port/&quot;</span>)
</pre>
</td>
</tr>
</table>

<p>wherein the supplied uri can point to any of the constituent worker nodes.</p>

<p>The client stack provides a facility for instantaneously spawning local runtimes:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 40)" onmouseover="showTip(event, 'fs4', 40)" class="i">runtime</span> <span class="o">=</span> <span class="i">MBraceRuntime</span><span class="o">.</span><span class="i">InitLocal</span>(<span class="i">totalNodes</span> <span class="o">=</span> <span class="n">4</span>, <span class="i">background</span> <span class="o">=</span> <span class="k">true</span>)
</pre>
</td>
</tr>
</table>

<p>This will initiate a runtime of four local nodes that execute in the background. 
The feature is particularly useful for quick deployments of distributed code under development.
The MBraceRuntime object serves as the entry point for any kind of client interactions with the cluster. 
For instance, the property</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs4', 41)" onmouseover="showTip(event, 'fs4', 41)" class="i">runtime</span><span class="o">.</span><span class="i">Nodes</span>
</pre>
</td>
</tr>
</table>

<p>returns the list of all nodes that constitute the cluster. In the MBrace shell, calling</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs4', 42)" onmouseover="showTip(event, 'fs4', 42)" class="i">runtime</span><span class="o">.</span><span class="i">ShowInfo</span>()
</pre>
</td>
</tr>
</table>

<p>prints a detailed description of the cluster to the terminal.</p>

<table class="pre"><tr><td><pre lang="ascii">{m}brace runtime information (active)

Host           Port  Role
----           ----  ----
grothendieck  38857  Master
grothendieck  38873  Alt Master  Local (Pid 3616)  mbrace://grothendieck:38873/
grothendieck  38865  Alt Master  Local (Pid 4952)  mbrace://grothendieck:38865/
</pre></td></tr></table>

<p>The state of the runtime can be reset or stopped at any point by calling the following methods:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs4', 43)" onmouseover="showTip(event, 'fs4', 43)" class="i">runtime</span><span class="o">.</span><span class="i">Shutdown</span>() <span class="c">// stops the runtime</span>
<span onmouseout="hideTip(event, 'fs4', 44)" onmouseover="showTip(event, 'fs4', 44)" class="i">runtime</span><span class="o">.</span><span class="i">Reboot</span>() <span class="c">// resets the state of the runtime</span>
<span onmouseout="hideTip(event, 'fs4', 45)" onmouseover="showTip(event, 'fs4', 45)" class="i">runtime</span><span class="o">.</span><span class="i">Kill</span>() <span class="c">// violently kills all node processes in the runtime</span>
</pre>
</td>
</tr>
</table>

<h2><a name="Managing-Cloud-Processes" class="anchor" href="#Managing-Cloud-Processes">Managing Cloud Processes</a></h2>

<p>A cloud process is a currently executing or completed cloud computation 
in the context of a specific MBrace runtime. 
In any given runtime, cloud processes can be initialized, monitored for progress, or cancelled; 
completed cloud processes can be queried for their results and 
symbolic stack traces can be fetched for failed executions.</p>

<p>Cloud processes form a fundamental organizational unit for the MBrace runtime: 
conceptually, if one is to think of MBrace as an operating system for the cloud, 
then cloud processes form its units of distributed execution; 
every cloud process spawns its own set of scheduler and workers; 
the MBrace runtime enforces a regime of process isolation, 
which means that each cloud process will run in a distinct 
instance of the CLR in the context of each worker node.</p>

<p>Given a runtime object, a cloud process can be initialized like so:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 46)" onmouseover="showTip(event, 'fs5', 46)" class="i">proc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 47)" onmouseover="showTip(event, 'fs4', 47)" class="i">runtime</span><span class="o">.</span><span class="i">CreateProcess</span> &lt;@ <span class="i">cloud</span> { <span class="k">return</span> <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> } @&gt;
</pre>
</td>
</tr>
</table>

<p>This will submit the workflow to the runtime for execution and 
return with a process handle of type 
<a href="http://nessos.github.io/MBrace/reference/nessos-mbrace-client-process-1.html"><code>Process&lt;int&gt;</code></a>. 
Various useful properties can be used to query the status 
of the cloud computation at any time. For instance,</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs5', 48)" onmouseover="showTip(event, 'fs5', 48)" class="i">proc</span><span class="o">.</span><span class="i">Result</span> <span class="c">// Pending, Value, user Exception or system Fault</span>
<span onmouseout="hideTip(event, 'fs5', 49)" onmouseover="showTip(event, 'fs5', 49)" class="i">proc</span><span class="o">.</span><span class="i">ProcessId</span> <span class="c">// the cloud process id</span>
<span onmouseout="hideTip(event, 'fs5', 50)" onmouseover="showTip(event, 'fs5', 50)" class="i">proc</span><span class="o">.</span><span class="i">InitTime</span> <span class="c">// returns a System.DateTime on execution start</span>
<span onmouseout="hideTip(event, 'fs5', 51)" onmouseover="showTip(event, 'fs5', 51)" class="i">proc</span><span class="o">.</span><span class="i">ExecutionTime</span> <span class="c">// returns a System.TimeSpan on execution time</span>
<span onmouseout="hideTip(event, 'fs5', 52)" onmouseover="showTip(event, 'fs5', 52)" class="i">proc</span><span class="o">.</span><span class="i">GetLogs</span>() <span class="c">// get user logs for cloud process</span>
</pre>
</td>
</tr>
</table>

<p>If running in the MBrace shell, typing the command</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs5', 53)" onmouseover="showTip(event, 'fs5', 53)" class="i">proc</span><span class="o">.</span><span class="i">ShowInfo</span>()
</pre>
</td>
</tr>
</table>

<p>will print information like the following</p>

<table class="pre"><tr><td><pre lang="ascii">Name       Process Id  Status   #Workers  #Tasks  Start Time         Result Type
----       ----------  ------   --------  ------  ----------         -----------
mapReduce        6674  Running         2       2  30/7/2013 4:08:21  (string * int) []
</pre></td></tr></table>

<p>Similar to <code>CreateProcess</code> is the <code>Run</code> method:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 54)" onmouseover="showTip(event, 'fs20', 54)" class="i">result</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 55)" onmouseover="showTip(event, 'fs4', 55)" class="i">runtime</span><span class="o">.</span><span class="i">Run</span> &lt;@ <span class="i">cloud</span> { <span class="k">return</span> <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> } @&gt;
</pre>
</td>
</tr>
</table>

<p>This is a blocking version of <code>CreateProcess</code> that is equivalent to the statement below:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 56)" onmouseover="showTip(event, 'fs5', 56)" class="i">proc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 57)" onmouseover="showTip(event, 'fs4', 57)" class="i">runtime</span><span class="o">.</span><span class="i">CreateProcess</span> &lt;@ <span class="i">cloud</span> { <span class="k">return</span> <span class="n">1</span> <span class="o">+</span> <span class="n">1</span> } @&gt; <span class="k">in</span>
<span onmouseout="hideTip(event, 'fs5', 58)" onmouseover="showTip(event, 'fs5', 58)" class="i">proc</span><span class="o">.</span><span class="i">AwaitResult</span>()
</pre>
</td>
</tr>
</table>

<p>A list of all executing cloud processes in a given runtime can be obtained as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 59)" onmouseover="showTip(event, 'fs21', 59)" class="i">procs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 60)" onmouseover="showTip(event, 'fs4', 60)" class="i">runtime</span><span class="o">.</span><span class="i">GetAllProcesses</span>()
</pre>
</td>
</tr>
</table>

<p>If running in the MBrace Shell, process information can be printed to the buffer like so:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs4', 61)" onmouseover="showTip(event, 'fs4', 61)" class="i">runtime</span><span class="o">.</span><span class="i">ShowProcessInfo</span>()
</pre>
</td>
</tr>
</table>

<p>Given a cloud process id, one can receive the corresponding handle object like so:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 62)" onmouseover="showTip(event, 'fs5', 62)" class="i">proc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 63)" onmouseover="showTip(event, 'fs4', 63)" class="i">runtime</span><span class="o">.</span><span class="i">GetProcess</span> <span class="n">1131</span> <span class="o">:?&gt;</span> <span class="i">Process</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs22', 64)" onmouseover="showTip(event, 'fs22', 64)" class="i">int</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 65)" onmouseover="showTip(event, 'fs23', 65)" class="i">proc&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 66)" onmouseover="showTip(event, 'fs4', 66)" class="i">runtime</span><span class="o">.</span><span class="i">GetProcess</span><span class="o">&lt;</span>(<span onmouseout="hideTip(event, 'fs24', 67)" onmouseover="showTip(event, 'fs24', 67)" class="i">string</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs22', 68)" onmouseover="showTip(event, 'fs22', 68)" class="i">int</span>) []<span class="o">&gt;</span> <span class="n">119</span>
</pre>
</td>
</tr>
</table>

<p>Finally, an executing cloud process can be cancelled with the following method</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span onmouseout="hideTip(event, 'fs5', 69)" onmouseover="showTip(event, 'fs5', 69)" class="i">proc</span><span class="o">.</span><span class="i">Kill</span>()
</pre>
</td>
</tr>
</table>

<h2><a name="The-MBrace-Daemon" class="anchor" href="#The-MBrace-Daemon">The MBrace Daemon</a></h2>

<p>As mentioned earlier, the MBrace daemon is the server-side application 
that contains a machine-wide instance of the MBrace framework. 
It is initialized by running the <code>mbraced.exe</code> executable, 
which can be found in the <code>tools</code> folder of the <code>MBrace.Runtime</code> nuget package. 
For instance, the command</p>

<table class="pre"><tr><td><pre lang="bash">$ mbraced.exe --hostname 127.0.0.1 --primary-port 2675 --detach
</pre></td></tr></table>

<p>will instantiate a background mbraced process that listens on the loopback interface at port 2675.</p>

<h3><a name="Configuring-the-MBrace-Daemon" class="anchor" href="#Configuring-the-MBrace-Daemon">Configuring the MBrace Daemon</a></h3>

<p>The MBrace daemon comes with a range of configuration options. 
These parameters can either be read from the mbraced configuration file, 
or passed as command line arguments, in that evaluation order. 
Command line parameters override those provided by the configuration file.</p>

<p>As is common in .NET applications, mbraced comes with an xml configuration file, 
namely mbraced.exe.config found in the same location as the executable. 
Configuration for mbraced is written in the <code>AppSettings</code> section 
of the xml document that follows a key-value schema:</p>

<table class="pre"><tr><td><pre lang="xml"><span class="prep">&lt;?</span>xml version=<span class="s">"1.0"</span> encoding=<span class="s">"utf-8"</span><span class="prep">?&gt;</span>
<span class="k">&lt;</span><span class="i">configuration</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">appSettings</span><span class="k">&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="hostname"</span> <span class="o">value</span><span class="k">="grothendieck.nessos"</span><span class="k">/&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="primary port"</span> <span class="o">value</span><span class="k">="2675"</span><span class="k">/&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="worker port range"</span> <span class="o">value</span><span class="k">="30000, 30042"</span><span class="k">/&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="working directory"</span> <span class="o">value</span><span class="k">="/var/mbraced/"</span><span class="k">/&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="log file"</span> <span class="o">value</span><span class="k">="mbrace-log.txt"</span><span class="k">/&gt;</span>
        <span class="c">&lt;!-- specify loglevel: info 0, warning 1, error 2--&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="log level"</span> <span class="o">value</span><span class="k">="0"</span><span class="k">/&gt;</span>
        <span class="c">&lt;!-- permitted operation modes; None: 0, Slave: 1, Master: 2, All: 3 --&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="permissions"</span> <span class="o">value</span><span class="k">="3"</span> <span class="k">/&gt;</span>
        <span class="c">&lt;!-- executable name of mbrace child process --&gt;</span>
        <span class="k">&lt;</span><span class="i">add</span> <span class="o">key</span><span class="k">="mbrace processdomain executable"</span> <span class="o">value</span><span class="k">="mbrace.worker.exe"</span><span class="k">/&gt;</span>
    <span class="k">&lt;/</span><span class="i">appSettings</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">configuration</span><span class="k">&gt;</span>
</pre></td></tr></table>

<p>The full range of command line parameters for mbraced can be viewed by typing</p>

<table class="pre"><tr><td><pre lang="bash">$ mbraced.exe --help
</pre></td></tr></table>

<p>We now give a brief description of the configuration parameters offered by the daemon:</p>

<ul>
<li><p>Hostname: the ip address or host name that the daemon listens to. The hostname must be resolvable in the context of
the entire MBrace cluster. Each instance of mbraced can only have one hostname specified.</p></li>
<li><p>Primary Port: the tcp port that the local cluster supervisor listens to.</p></li>
<li><p>Worker Port Range: a range or collection of tcp ports that can be assigned to 
worker processes spawned by the local cluster supervisor.</p></li>
<li><p>Working Directory: the local directory in which all local caching is performed. 
Write permissions are required for the daemon process.</p></li>
<li><p>Log File: specifies the path to the log file. If relative, 
it is resolved with respect to the working directory.</p></li>
<li><p>Log Level: specifies the log level: 0 for info, 1 for warnings, 2 for errors.</p></li>
<li><p>ProcessDomain Executable: the location of the worker process executable. 
Relative paths evaluated with respect to the main <code>mbraced.exe</code> path.</p></li>
</ul>

<h3><a name="Deploying-the-MBrace-Daemon" class="anchor" href="#Deploying-the-MBrace-Daemon">Deploying the MBrace Daemon</a></h3>

<p>Once the configuration file for <code>mbraced</code> has been set up as desired, 
deploying an instance from the command line is as simple as typing</p>

<table class="pre"><tr><td><pre lang="bash">$ mbraced --detach
</pre></td></tr></table>

<p>The MBrace framework also comes with the <code>mbracectl</code> command line tool 
that can be used to track deployment state. Initiating a session can be done like so:</p>

<table class="pre"><tr><td><pre lang="bash">$ mbracectl start
</pre></td></tr></table>

<p>This will initialize a background instance with settings read from the mbraced configuration file. 
Session state can be queried by entering</p>

<table class="pre"><tr><td><pre lang="bash">$ mbracectl status
</pre></td></tr></table>

<p>Finally, a session can be ended by typing</p>

<table class="pre"><tr><td><pre lang="bash">$ mbracectl stop
</pre></td></tr></table>

<p><code>mbracectl</code> can also be used to initiate multiple instances on the local machine</p>

<table class="pre"><tr><td><pre lang="bash">$ mbracectl start --nodes 16 --spawn-window
</pre></td></tr></table>

<p>that can even be booted in a local cluster</p>

<table class="pre"><tr><td><pre lang="bash">$ mbracectl start --nodes 3 --boot
</pre></td></tr></table>

<p>The MBrace installer also comes bundled with a windows service. 
Initiating <code>mbraced</code> as a service will spawn a background instance 
with settings read from the xml configuration file.</p>

<div class="tip" id="fs1">val config : obj<br /><br />Full name: Client-api.config</div>
<div class="tip" id="fs2">module Unchecked<br /><br />from Microsoft.FSharp.Core.Operators</div>
<div class="tip" id="fs3">val defaultof&lt;&#39;T&gt; : &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.Unchecked.defaultof</div>
<div class="tip" id="fs4">val runtime : obj<br /><br />Full name: Client-api.runtime</div>
<div class="tip" id="fs5">val proc : obj<br /><br />Full name: Client-api.proc</div>
<div class="tip" id="fs6">val expr : Quotations.Expr&lt;int&gt;<br /><br />Full name: Client-api.expr</div>
<div class="tip" id="fs7">val test : unit -&gt; &#39;a<br /><br />Full name: Client-api.test</div>
<div class="tip" id="fs8">val f : x:int -&gt; int<br /><br />Full name: Client-api.f</div>
<div class="tip" id="fs9">val x : int</div>
<div class="tip" id="fs10">val fsStore : obj<br /><br />Full name: Client-api.fsStore</div>
<div class="tip" id="fs11">val sqlStore : obj<br /><br />Full name: Client-api.sqlStore</div>
<div class="tip" id="fs12">val azureStore : obj<br /><br />Full name: Client-api.azureStore</div>
<div class="tip" id="fs13">val node : obj<br /><br />Full name: Client-api.node</div>
<div class="tip" id="fs14">val node&#39; : obj<br /><br />Full name: Client-api.node&#39;</div>
<div class="tip" id="fs15">val node&#39;&#39; : obj<br /><br />Full name: Client-api.node&#39;&#39;</div>
<div class="tip" id="fs16">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs17">val filter : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.filter</div>
<div class="tip" id="fs18">val entry : obj</div>
<div class="tip" id="fs19">val nodes : obj list<br /><br />Full name: Client-api.nodes</div>
<div class="tip" id="fs20">val result : obj<br /><br />Full name: Client-api.result</div>
<div class="tip" id="fs21">val procs : obj<br /><br />Full name: Client-api.procs</div>
<div class="tip" id="fs22">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs23">val proc&#39; : obj<br /><br />Full name: Client-api.proc&#39;</div>
<div class="tip" id="fs24">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>

        </div>
        <div class="span3">
          <a href="http://www.m-brace.net/index.html">
            <img src="http://www.m-brace.net/img/mbrace.png" alt="F# Project" style="width:150px;margin:10px" />
          </a>
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">MBrace</li>
            <li><a href="http://www.m-brace.net/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://www.nuget.org/packages/MBrace.Core">Get Library via NuGet</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core">Source Code on GitHub</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/LICENSE.md">License</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

            <li class="nav-header">Getting Started</li>
            <li><a href="http://www.m-brace.net/runtime-deployment.html">Cluster Deployment Guide</a></li>
            <li><a href="http://www.m-brace.net/azure-tutorial.html">Azure Guide</a></li>
            <li class="divider"></li>
            <li><a target="_blank" href="http://skillsmatter.com/skillscasts/5157-mbrace-large-scale-distributed-computation-with-f">Video presentation</a></li>
            <li><a target="_blank" href="http://www.m-brace.net/mbrace-plos.pdf">PLOS'13 Publication</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://www.m-brace.net/programming-model.html">Programming model</a></li>
            <li><a href="http://www.m-brace.net/client-api.html">Client API</a></li>
            <li><a target="_blank" href="http://www.m-brace.net/mbrace-manual.pdf">MBrace Manual</a></li>
            <li><a href="http://www.m-brace.net/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/mbraceproject/MBrace.Core"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
